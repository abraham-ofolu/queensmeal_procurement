{% extends "base.html" %}
{% block content %}

<h2>Director Approvals</h2>

<hr>

<h3>Pending Requests</h3>
{% if pending and pending|length > 0 %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Item</th>
        <th>Qty</th>
        <th>Amount</th>
        <th>Urgent</th>
        <th>Vendor</th>
        <th>Quotation</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for r in pending %}
      <tr>
        <td>#{{ r.id }}</td>
        <td>{{ r.item }}</td>
        <td>{{ r.quantity }}</td>
        <td>{{ r.amount }}</td>
        <td>{% if r.is_urgent %}✅{% else %}—{% endif %}</td>
        <td>
          {% if r.vendor %}
            <strong>{{ r.vendor.name }}</strong><br>
            <small>
              {% if r.vendor.bank_name %}{{ r.vendor.bank_name }}{% endif %}
              {% if r.vendor.account_number %} - {{ r.vendor.account_number }}{% endif %}
            </small>
          {% else %}
            <em>No vendor</em>
          {% endif %}
        </td>
        <td>
          {% if r.quotations and r.quotations|length > 0 %}
            <a href="{{ r.quotations[-1].file_path }}" target="_blank">View</a>
          {% else %}
            <em>None</em>
          {% endif %}
        </td>
        <td>
          <form method="POST" action="{{ url_for('director.approve', request_id=r.id) }}" style="display:inline;">
            <button class="btn btn-sm btn-success" type="submit">Approve</button>
          </form>
          <form method="POST" action="{{ url_for('director.reject', request_id=r.id) }}" style="display:inline;">
            <button class="btn btn-sm btn-danger" type="submit">Reject</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% else %}
  <p><em>No pending requests.</em></p>
{% endif %}

<hr>

<h3>Approved (Unpaid) — Director Can Pay</h3>
{% if approved_unpaid and approved_unpaid|length > 0 %}
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>Item</th>
        <th>Amount</th>
        <th>Vendor</th>
        <th>Quotation</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
    {% for r in approved_unpaid %}
      <tr>
        <td>#{{ r.id }}</td>
        <td>{{ r.item }}</td>
        <td>{{ r.amount }}</td>
        <td>
          {% if r.vendor %}
            {{ r.vendor.name }}<br>
            <small>
              {% if r.vendor.bank_name %}{{ r.vendor.bank_name }}{% endif %}
              {% if r.vendor.account_number %} - {{ r.vendor.account_number }}{% endif %}
            </small>
          {% else %}
            <em>No vendor</em>
          {% endif %}
        </td>
        <td>
          {% if r.quotations and r.quotations|length > 0 %}
            <a href="{{ r.quotations[-1].file_path }}" target="_blank">View</a>
          {% else %}
            <em>None</em>
          {% endif %}
        </td>
        <td>
          <a class="btn btn-sm btn-primary" href="{{ url_for('director.pay', request_id=r.id) }}">Pay</a>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
{% else %}
  <p><em>No approved-unpaid requests.</em></p>
{% endif %}

{% endblock %}
