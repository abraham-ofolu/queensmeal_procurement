{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Director Approvals</h2>

    {% for req in requests %}
    <div class="card mb-3">
        <div class="card-body">
            <h5>{{ req.item }}</h5>

            <p>
                <strong>Vendor:</strong> {{ req.vendor.name if req.vendor else "N/A" }}<br>
                <strong>Amount:</strong> ₦{{ req.amount }}<br>
                <strong>Status:</strong> {{ req.status }}
            </p>

            {% if req.quotations %}
                <p><strong>Quotation:</strong></p>
                {% for q in req.quotations %}
                    <a href="{{ q.file_path }}" target="_blank">View Quotation</a><br>
                {% endfor %}
            {% endif %}

            {% if req.status == "pending" %}
                <form method="POST" action="{{ url_for('director.approve', request_id=req.id) }}" style="display:inline;">
                    <button class="btn btn-success">Approve</button>
                </form>

                <form method="POST" action="{{ url_for('director.reject', request_id=req.id) }}" style="display:inline;">
                    <button class="btn btn-danger">Reject</button>
                </form>
            {% endif %}

            {% if req.status == "approved" %}
                <hr>
                <form method="POST"
                      action="{{ url_for('director.pay', request_id=req.id) }}"
                      enctype="multipart/form-data">

                    <div class="mb-2">
                        <label>Amount Paid</label>
                        <input type="number" name="amount_paid" class="form-control" required>
                    </div>

                    <div class="mb-2">
                        <label>Upload Receipt</label>
                        <input type="file" name="receipt" class="form-control">
                    </div>

                    <button class="btn btn-primary">Pay & Upload Receipt</button>
                </form>
            {% endif %}

            {% if req.payments %}
                <hr>
                <h6>Payments</h6>
                {% for p in req.payments %}
                    <p>
                        Paid ₦{{ p.amount_paid }} by {{ p.paid_by_role }}<br>
                        {% if p.receipt_url %}
                            <a href="{{ p.receipt_url }}" target="_blank">View Receipt</a>
                        {% endif %}
                    </p>
                {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
