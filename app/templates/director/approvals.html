{% extends "base.html" %}
{% block content %}

<h2 class="mb-3">Director Approvals</h2>

<div class="alert alert-info">
  Finance can pay up to <b>{{ "{:,.2f}".format(limit) }}</b>. Director pays above that.
</div>

<h4>Pending Director Approval</h4>
<table class="table table-striped mb-4">
  <thead>
    <tr>
      <th>ID</th><th>Item</th><th>Qty</th><th>Amount</th><th>Quotation</th><th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for r in pending %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.item }}</td>
        <td>{{ r.quantity }}</td>
        <td>{{ "{:,.2f}".format(r.amount or 0) }}</td>
        <td>
          {% if r.quotation_url %}
            <a href="{{ r.quotation_url }}" target="_blank">View</a>
          {% else %}-{% endif %}
        </td>
        <td style="display:flex; gap:8px;">
          <form method="POST" action="{{ url_for('director.approve', req_id=r.id) }}">
            <button class="btn btn-sm btn-success">Approve</button>
          </form>
          <form method="POST" action="{{ url_for('director.reject', req_id=r.id) }}">
            <button class="btn btn-sm btn-danger">Reject</button>
          </form>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<h4>Approved (Awaiting Payment)</h4>
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th><th>Item</th><th>Amount</th><th>Who Pays</th><th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for r in approved %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.item }}</td>
        <td>{{ "{:,.2f}".format(r.amount or 0) }}</td>
        <td>
          {% if (r.amount or 0) > limit %}
            Director
          {% else %}
            Finance
          {% endif %}
        </td>
        <td>
          {% if (r.amount or 0) > limit %}
            <a class="btn btn-sm btn-primary" href="{{ url_for('director.pay', req_id=r.id) }}">Pay + Upload Receipt</a>
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
