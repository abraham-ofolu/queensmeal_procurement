{% extends "base.html" %}
{% block content %}

<h2>Director Approvals</h2>

<hr>

<h3>Pending Requests</h3>
<!-- (unchanged – already working) -->

<hr>

<h3>Approved (Unpaid)</h3>
<!-- (unchanged – already working) -->

<hr>

<h3>Paid Requests (Audit View)</h3>

{% set paid = approved_unpaid | selectattr("status", "equalto", "paid") | list %}

{% if paid and paid|length > 0 %}
<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Item</th>
      <th>Vendor</th>
      <th>Amount</th>
      <th>Paid By</th>
      <th>Receipt</th>
      <th>Paid At</th>
    </tr>
  </thead>
  <tbody>
  {% for r in paid %}
    {% set p = r.payments[-1] %}
    <tr>
      <td>#{{ r.id }}</td>
      <td>{{ r.item }}</td>
      <td>{{ r.vendor.name if r.vendor else "—" }}</td>
      <td>{{ p.amount_paid or p.amount }}</td>
      <td>{{ p.paid_by_role }} ({{ p.paid_by_name }})</td>
      <td>
        {% if p.receipt_url %}
          <a href="{{ p.receipt_url }}" target="_blank">View</a>
        {% else %}
          —
        {% endif %}
      </td>
      <td>{{ p.paid_at }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p><em>No paid requests yet.</em></p>
{% endif %}

{% endblock %}
