{% extends "base.html" %}
{% block content %}

<h2>Finance Payments (Limit: {{ finance_limit }})</h2>

{% if requests %}
<table border="1" cellpadding="6" cellspacing="0">
  <tr>
    <th>ID</th>
    <th>Item</th>
    <th>Description</th>
    <th>Amount</th>
    <th>Vendor</th>
    <th>Quotation</th>
    <th>Pay + Upload Proof</th>
  </tr>

  {% for r in requests %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.item }}</td>
    <td>{{ r.description }}</td>
    <td>{{ r.amount }}</td>
    <td>
      {% if r.vendor %}
        {{ r.vendor.name }}<br>
        {{ r.vendor.bank_name }}<br>
        {{ r.vendor.account_name }}<br>
        {{ r.vendor.account_number }}
      {% else %}
        —
      {% endif %}
    </td>
    <td>
      {% if r.quotations and r.quotations|length > 0 %}
        <a href="{{ r.quotations[0].file_path }}" target="_blank">View</a>
      {% else %}
        —
      {% endif %}
    </td>
    <td>
      <form method="POST" action="{{ url_for('finance.pay', request_id=r.id) }}" enctype="multipart/form-data">
        <div>
          <input type="file" name="receipt" accept=".pdf,image/*">
        </div>
        <div>
          <input type="text" name="notes" placeholder="Notes (optional)" style="width: 260px;">
        </div>
        <button type="submit">Mark Paid</button>
      </form>
    </td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No approved requests available for Finance payment.</p>
{% endif %}

{% endblock %}
