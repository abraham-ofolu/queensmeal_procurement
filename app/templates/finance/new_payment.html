{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="fw-bold">Record Payment</h3>
  <p class="text-muted mb-1">
    Procurement Request: <span class="fw-semibold">#{{ pr.id }}</span> — {{ pr.title }}
  </p>
  <p class="text-muted">
    Total: <span class="fw-semibold">₦{{ "{:,.2f}".format(pr.amount) }}</span> |
    Paid: <span class="fw-semibold">₦{{ "{:,.2f}".format(total_paid) }}</span> |
    Remaining: <span class="fw-semibold text-danger">₦{{ "{:,.2f}".format(remaining) }}</span>
  </p>

  {% if current_user.role == "finance" %}
    <div class="alert alert-info">
      Finance can only record a single payment up to <b>₦{{ "{:,.2f}".format(limit) }}</b>.
      Above this limit, the <b>Director</b> must pay.
    </div>
  {% endif %}

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST" class="card p-3 shadow-sm">
    <div class="row g-3">
      <div class="col-md-7">
        <label class="form-label">Description</label>
        <input name="description" class="form-control" placeholder="e.g. First tranche payment" required>
      </div>

      <div class="col-md-3">
        <label class="form-label">Amount (₦)</label>
        <input name="amount" class="form-control" placeholder="e.g. 50000" required>
      </div>

      <div class="col-md-2">
        <label class="form-label">Paid Date</label>
        <input name="paid_at" type="date" class="form-control">
      </div>
    </div>

    <div class="mt-3 d-flex gap-2">
      <button class="btn btn-success">Save Payment</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('procurement.view_request', req_id=pr.id) }}">Back</a>
    </div>
  </form>
</div>
{% endblock %}
